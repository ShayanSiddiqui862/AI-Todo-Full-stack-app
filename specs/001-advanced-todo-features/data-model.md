# Data Model: Advanced Todo Features

## Task Entity

### Fields
- **id** (Integer, Primary Key, Auto-increment)
  - Unique identifier for each task
  - Auto-generated by the database

- **title** (String, Required)
  - The main title or name of the task
  - Max length: 255 characters

- **description** (Text, Optional)
  - Detailed description of the task
  - Can be null or empty

- **completed** (Boolean, Default: false)
  - Indicates whether the task has been completed
  - Used for filtering completed vs active tasks

- **user_id** (String, Required)
  - Identifier for the user who owns the task
  - Enables multi-tenancy and proper task ownership

- **priority** (Enum: low, medium, high, Default: medium)
  - Priority level of the task
  - Enables sorting and filtering by importance

- **tags** (Array of Strings, Default: [])
  - Array of tags associated with the task
  - Enables categorization and filtering by tags

- **due_date** (DateTime with Timezone, Optional)
  - Date and time when the task is due
  - Can be null if no due date is set

- **remind_at** (DateTime with Timezone, Optional)
  - Date and time when the user should be reminded about the task
  - Can be null if no reminder is set

- **recurrence_type** (Enum: none, daily, weekly, monthly, Default: none)
  - Defines the recurrence pattern of the task
  - 'none' indicates a one-time task

- **recurrence_interval** (Integer, Default: 1)
  - Interval multiplier for recurrence (e.g., every 2 weeks)
  - Used in combination with recurrence_type

- **created_at** (DateTime with Timezone, Default: now())
  - Timestamp when the task was created
  - Automatically set by the database

- **updated_at** (DateTime with Timezone, Default: now())
  - Timestamp when the task was last updated
  - Automatically updated by the system

### Relationships
- **User** (Many-to-One)
  - Each task belongs to a single user
  - Implemented via user_id foreign key

### Validation Rules
- title must not be empty
- priority must be one of: 'low', 'medium', 'high'
- tags array elements must be non-empty strings
- due_date must be in the future if set
- remind_at must be before due_date if both are set
- recurrence_type must be one of: 'none', 'daily', 'weekly', 'monthly'
- recurrence_interval must be positive if recurrence_type is not 'none'

### State Transitions
- Active → Completed: When task is marked as completed
- Completed → Active: When task completion is undone (optional feature)
- One-time → Recurring: When recurrence is enabled on an existing task
- Recurring → One-time: When recurrence is disabled on a recurring task

## Scheduled Jobs Entity

### Fields
- **id** (String, Primary Key)
  - Dapr job ID for the scheduled job
  - Format: "{job_type}-{task_id}-{uuid}"

- **job_type** (String, Required)
  - Type of job: 'reminder', 'recurring_next'
  - Determines how the job is processed

- **task_id** (Integer, Foreign Key)
  - Reference to the associated task
  - May be null for certain job types

- **user_id** (String, Required)
  - User associated with the scheduled job
  - Enables proper ownership and permissions

- **scheduled_time** (DateTime with Timezone, Required)
  - Time when the job is scheduled to execute
  - Used by Dapr to trigger the job

- **created_at** (DateTime with Timezone, Default: now())
  - Timestamp when the job was scheduled
  - Automatically set by the system

- **executed** (Boolean, Default: false)
  - Indicates whether the job has been executed
  - Used for tracking and cleanup purposes

### Relationships
- **Task** (Many-to-One)
  - Each scheduled job relates to a single task
  - Implemented via task_id foreign key

### Validation Rules
- job_type must be one of: 'reminder', 'recurring_next'
- scheduled_time must be in the future
- task_id must reference an existing task if provided

## Task Events Entity

### Fields
- **id** (Integer, Primary Key, Auto-increment)
  - Unique identifier for each event
  - Auto-generated by the database

- **event_type** (String, Required)
  - Type of event: 'created', 'updated', 'completed', 'deleted', 'reminder_triggered', 'notification_sent'
  - Defines the nature of the task operation

- **task_id** (Integer, Foreign Key, Optional)
  - Reference to the associated task
  - May be null for certain event types

- **user_id** (String, Required)
  - User associated with the event
  - Enables proper ownership tracking

- **payload** (JSONB, Required)
  - Additional data associated with the event
  - Contains task data, timestamps, and other relevant information

- **created_at** (DateTime with Timezone, Default: now())
  - Timestamp when the event was created
  - Automatically set by the database

### Relationships
- **Task** (Many-to-One)
  - Each event relates to a single task
  - Implemented via task_id foreign key

### Validation Rules
- event_type must be one of the predefined values
- payload must be valid JSON
- task_id must reference an existing task if provided